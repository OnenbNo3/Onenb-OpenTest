using System;
using System.Windows.Forms;

namespace KWSTEST
{
    public enum Operators
    {
        Plus,
        Minus,
        Equal,
        Non
    }

    public enum ClickChcek
    {
        Num_Key,
        Plus_Key,
        Minus_Key,
        Equal_Key,
        Non

    }

    public partial class Form1 : Form
    {
        public int Result = 0;
        public bool IsNewNum = true;
        public ClickChcek LastClick = ClickChcek.Non;
        public Operators opt = Operators.Non;

        //History Box저장용
        int SaveData = 0;
        int SaveData2 = 0;

        int MaxNum = int.MaxValue;
        int MinNum = int.MinValue;

        public Form1()
        {
            InitializeComponent();

            //첨에 0으로 초기화 하면서 시작
            txtScreenBox.Text = "0";
        }


        private void btnClear_Click(object sender, EventArgs e)
        {
            //계산기 초기화 기능
            //결과값/ 결과값UI/ 히스토리 UI 초기화필요
            Result = 0;
            //IsNewNum = true;
            txtScreenBox.Clear();
            txtHistoryBox.Clear();

            SaveData = 0;
            SaveData2 = 0;

            LastClick = ClickChcek.Non;
            opt = Operators.Non;

        }

        //↓↓↓↓ 정리 필요(Test소스)↓↓↓↓↓
        //private void btnEqual_Click(object sender, EventArgs e)
        //{
        //    string strCalc = txtScreenBox.Text;  // 텍스트 박스의 문자열을 가져올때
        //    char[] arrCalc = strCalc.ToCharArray();  // 문자열을 문자 배열로 변경

        //    double[] arrNum = new double[100];  // 연산 숫자 배열
        //    char[] arrOp = new char[100];  // 연산자 배열
        //    int numCnt = 0;
        //    int opCnt = 0;
        //    bool contNum = false;

        //    for (int i = 0; i < arrCalc.Length; i++)
        //    {
        //        if ((arrCalc[i] >= '0') && (arrCalc[i] <= '9'))
        //        {
        //            if (contNum)
        //                arrNum[numCnt] = (arrNum[numCnt] * 10) + double.Parse(arrCalc[i].ToString());
        //            else
        //                arrNum[numCnt] = double.Parse(arrCalc[i].ToString());


        //            contNum = true;
        //        }
        //        else
        //        {
        //            numCnt++;
        //            arrOp[opCnt++] = arrCalc[i];

        //            contNum = false;
        //        }
        //    }

        //    double resultCalc = 0;

        //    for (int i = 0; i < opCnt; i++)
        //    {
        //        switch (arrOp[i])
        //        {
        //            case '+':
        //                arrNum[i + 1] = arrNum[i] + arrNum[i + 1];
        //                break;

        //            case '-':
        //                arrNum[i + 1] = arrNum[i] - arrNum[i + 1];
        //                break;

        //            default:
        //                break;
        //        }
        //        resultCalc = arrNum[i + 1];
        //    }

        //    //Console.WriteLine(resultCalc);
        //    txtHisToryBox.Text = resultCalc.ToString();
        //    txtScreenBox.Text = txtHisToryBox.Text;
        //}

        // ↑↑↑↑↑ 정리 필요(Test소스) ↑↑↑↑↑↑↑


        private void btnBackClear_Click(object sender, EventArgs e)
        {
            string Result = txtScreenBox.Text;

            if (txtScreenBox.Text != "" && txtScreenBox.Text != null)
            {
                if (Result.Length == 0)
                {
                    txtScreenBox.Text = "0";
                }

                txtScreenBox.Text = txtScreenBox.Text.Remove(txtScreenBox.Text.Length - 1);
            }

            //↓↓↓↓ 정리 필요(Test소스)↓↓↓↓↓
            //txtScreenBox.Text = txtScreenBox.Text.Substring(0, txtScreenBox.Text.Length - 1); 
        }
        private void btnCheck_Click(object sender, EventArgs e)
        {
            Button NumBtn = (Button)sender;
            SetNum(NumBtn.Text);
        }

        public void SetNum(string Num)
        {
            //Num = numbtn.text
            string Screen = txtScreenBox.Text;
            int NumChcek;

            if (Screen == "0" || LastClick == ClickChcek.Equal_Key || LastClick == ClickChcek.Plus_Key || LastClick == ClickChcek.Minus_Key)
            {
                if (LastClick == ClickChcek.Equal_Key)
                {
                    txtHistoryBox.Text = "";
                }
                txtScreenBox.Text = Num;
            }
            else
            {
                if (int.TryParse(Screen + Num, out NumChcek) == true)
                {
                    if (MinNum < NumChcek && NumChcek < MaxNum)
                    {
                        Screen += Num;
                    }
                    txtScreenBox.Text = Screen;
                }
            }

            LastClick = ClickChcek.Num_Key;

            //↓↓↓↓ 정리 필요(Test소스)↓↓↓↓↓
            //if (int.TryParse(txtScreenBox.Text + Num, out NumChcek) == true)
            //{               

            //    if (MinNum <= NumChcek && NumChcek <= MaxNum)
            //    {

            //            if (txtScreenBox.Text == "0")
            //            {
            //                txtScreenBox.Text = Num;
            //            }
            //            else
            //            {
            //                txtScreenBox.Text += Num;
            //            }

            //    }
            //}       

        }


        private void btnSign_Click(object sender, EventArgs e)
        {
            if (txtScreenBox.Text != "" && txtScreenBox.Text.Length != 0)
            {
                txtScreenBox.Text = (-1 * double.Parse(txtScreenBox.Text)).ToString();
            }
        }
        private void btnEqual_Click(object sender, EventArgs e)
        {




        }

        private void Cal_Click(object sender, EventArgs e)
        {
            Button NumBtn = (Button)sender;
            string Cal = NumBtn.Text;

            if (txtScreenBox.Text.Length != 0)
            {
                Result = int.Parse(txtScreenBox.Text);
            }

            if (txtScreenBox.Text.Length == 0)
            {
                txtScreenBox.Text = "0";
            }

            //txtHistoryBox.Text = txtScreenBox.Text;
            //txtScreenBox.Text = Result.ToString();
            //if (LastClick == ClickChcek.Equal_Key)
            //{
            //    if (opt == Operators.Equal)
            //    {
            //        txtHistoryBox.Text = Result + Cal;
            //    }
            //}

            if (LastClick != ClickChcek.Plus_Key && LastClick != ClickChcek.Minus_Key)
            {
                if (opt == Operators.Non || opt == Operators.Equal)
                {
                    SaveData = Result;
                }
                else
                {
                    SaveData2 = Result;
                    Result = CalNum(SaveData, SaveData2, opt);
                    SaveData = Result;
                }

                txtHistoryBox.Text = SaveData + Cal;
            }
            else
            {
                txtHistoryBox.Text = SaveData + Cal;
            }

            //↓↓↓↓ 정리 필요(Test소스)↓↓↓↓↓
            //if (txtScreenBox.Text.Length == 0)
            //{
            //    Result = int.Parse(SaveData2.ToString());
            //}

            txtScreenBox.Text = Result.ToString();
            //else if()
            //{
            //    txtHistoryBox.Text = txtScreenBox + Cal;
            //}

            if (Cal == "+")
            {
                opt = Operators.Plus;
                LastClick = ClickChcek.Plus_Key;
            }
            else if (Cal == "-")
            {
                opt = Operators.Minus;
                LastClick = ClickChcek.Minus_Key;
            }
            else if (Cal == "=")
            {
                opt = Operators.Equal;
                LastClick = ClickChcek.Equal_Key;
            }

            //↓↓↓↓ 정리 필요(Test소스)↓↓↓↓↓
            //----------------
            //if (IsNewNum == false)
            //{
            //    int num = int.Parse(txtScreenBox.Text);
            //    if (opt == Operators.Plus)
            //    {
            //        Result += num;

            //    }
            //    else if (opt == Operators.Minus)
            //    {
            //        Result -= num;
            //    }

            //    txtScreenBox.Text = Result.ToString();
            //    IsNewNum = true; // 신규 숫자 입력 받는 플래그

            //}

            //Button optButton = (Button)sender;
            //if (optButton.Text == "+")
            //{
            //    opt = Operators.Plus;
            //}
            //else if (optButton.Text == "-")
            //{
            //    opt = Operators.Minus;
            //}

            //txtHistoryBox.Text = txtScreenBox.Text + optButton.Text;

        }

        public int CalNum(int SaveData, int SaveData2, Operators Opm)
        {
            int result;

            switch (Opm)
            {
                case Operators.Plus:
                    result = SaveData + SaveData2;
                    break;

                case Operators.Minus:
                    result = SaveData - SaveData2;
                    break;

                default:
                    result = 0;
                    break;
            }


            return result;
        }

     




        /////
        /////↓↓↓↓ 정리 필요(Test소스)↓↓↓↓↓
        //private void btnPlus_Click(object sender, EventArgs e)
        //{
        //    int num = int.Parse(txtScreenBox.Text);
        //    Result = Result + num;

        //    txtScreenBox.Text = Result.ToString();
        //    IsNewNum = true; // 신규 숫자 입력 받는 플래그

        //    txtHisToryBox.Text = txtScreenBox.Text;


        //}
        //private void btnMinus_Click(object sender, EventArgs e)
        //{
        //    int num = int.Parse(txtScreenBox.Text);
        //    if (opt == Operators.Plus)
        //    {
        //        Result = Result + num;

        //    }
        //    else if (opt == Operators.Minus)
        //    {
        //        Result = Result - num;
        //    }

        //    txtScreenBox.Text = Result.ToString();
        //    IsNewNum = true; // 신규 숫자 입력 받는 플래그

        //    Button optButton = (Button)sender;
        //    if (optButton.Text == "+")
        //    {
        //        opt = Operators.Plus;
        //    }
        //    else if (optButton.Text == "-")
        //    {
        //        opt = Operators.Minus;
        //    }

        //    txtHisToryBox.Text = txtScreenBox.Text;
        //}

    }
}